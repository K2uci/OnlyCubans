{% extends "content/base/base.html" %}
{% load static %}

{% block title %}Dashboard - OnlyCubans{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/content/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header del Dashboard -->
    <div class="dashboard-header">
        <div class="welcome-section">
            <h1>Hola, {{ user.username }}! 游녦</h1>
            <p>Bienvenido a tu panel de control. Aqu칤 tienes un resumen de tu actividad.</p>
            
            {% if user.is_creator %}
            <div class="quick-stats">
                <div class="stat-card">
                    <span class="stat-number">{{ stats.total_posts|default:0 }}</span>
                    <span class="stat-label">Publicaciones</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ stats.total_views|default:0 }}</span>
                    <span class="stat-label">Vistas Totales</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ stats.total_likes|default:0 }}</span>
                    <span class="stat-label">Me Gusta</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ user.creator_profile.total_subscribers|default:0 }}</span>
                    <span class="stat-label">Suscriptores</span>
                </div>
            </div>
            {% else %}
            <div class="quick-stats">
                <div class="stat-card">
                    <span class="stat-number">{{ user.following_count }}</span>
                    <span class="stat-label">Siguiendo</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ user.posts.count }}</span>
                    <span class="stat-label">Mis Posts</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ user.bookmarks.count }}</span>
                    <span class="stat-label">Guardados</span>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- Columna Principal -->
        <div class="dashboard-main">
            {% if user.is_creator %}
            <!-- Dashboard para Creadores -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-line"></i> M칠tricas de Rendimiento</h2>
                </div>
                <div class="section-content">
                    <div class="creator-stats">
                        <div class="metric-item">
                            <span class="metric-value">{{ stats.total_earnings|default:0|floatformat:2 }}$</span>
                            <span class="metric-label">Ganancias Totales</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value">{{ stats.engagement_rate|default:0|floatformat:1 }}%</span>
                            <span class="metric-label">Tasa de Engagement</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value">{{ stats.avg_views|default:0 }}</span>
                            <span class="metric-label">Vistas/Promedio</span>
                        </div>
                    </div>
                    
                    <div class="earnings-chart">
                        <div class="chart-header">
                            <h3>Ganancias Mensuales</h3>
                            <select class="form-control" style="width: auto;">
                                <option>칔ltimos 30 d칤as</option>
                                <option>칔ltimos 90 d칤as</option>
                                <option>Este a침o</option>
                            </select>
                        </div>
                        <div class="chart-placeholder">
                            <i class="fas fa-chart-bar"></i>
                            <span>Gr치fico de ganancias (pr칩ximamente)</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Actividad Reciente -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-bell"></i> Actividad Reciente</h2>
                    <a href="#" class="view-all">Ver todo</a>
                </div>
                <div class="section-content">
                    <div class="activity-list">
                        {% for like in recent_activity.new_likes|slice:":5" %}
                        <div class="activity-item">
                            <img src="{% if like.user.profile_picture %}{{ like.user.profile_picture.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}" 
                                 alt="{{ like.user.username }}" 
                                 class="activity-avatar">
                            <div class="activity-content">
                                <div class="activity-text">
                                    <strong>{{ like.user.username }}</strong> le dio me gusta a tu publicaci칩n
                                </div>
                                <div class="activity-time">{{ like.created_at|timesince }} ago</div>
                            </div>
                            <span class="activity-badge">Like</span>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <i class="fas fa-bell-slash"></i>
                            <h3>No hay actividad reciente</h3>
                            <p>Tu actividad aparecer치 aqu칤 cuando interact칰en con tu contenido.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Publicaciones Recientes -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-newspaper"></i> Tus Publicaciones Recientes</h2>
                    <a href="{% url 'content:post_create' %}" class="view-all">Crear nuevo</a>
                </div>
                <div class="section-content">
                    {% if recent_posts %}
                    <div class="content-cards">
                        {% for post in recent_posts %}
                        <div class="content-card">
                            {% if post.media_files.first %}
                            <img src="{{ post.media_files.first.file.url }}" 
                                 alt="{{ post.title }}"
                                 class="content-card-image">
                            {% else %}
                            <div class="content-card-image" style="background: var(--gray-light); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-image fa-2x" style="color: var(--text-gray);"></i>
                            </div>
                            {% endif %}
                            <div class="content-card-body">
                                <h4 class="content-card-title">{{ post.title|truncatewords:8 }}</h4>
                                <p style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: var(--spacing-sm);">
                                    {{ post.description|truncatewords:12 }}
                                </p>
                                <div class="content-card-stats">
                                    <span><i class="fas fa-eye"></i> {{ post.views_count }}</span>
                                    <span><i class="fas fa-heart"></i> {{ post.likes_count }}</span>
                                    <span><i class="fas fa-comment"></i> {{ post.comments_count }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-edit"></i>
                        <h3>No hay publicaciones a칰n</h3>
                        <p>Comienza creando tu primera publicaci칩n para compartir con la comunidad.</p>
                        <a href="{% url 'content:post_create' %}" class="btn btn-primary mt-3">
                            <i class="fas fa-plus"></i> Crear Primera Publicaci칩n
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar del Dashboard -->
        <div class="dashboard-sidebar">
            <!-- Acciones R치pidas -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-bolt"></i> Acciones R치pidas</h2>
                </div>
                <div class="section-content">
                    <div class="quick-actions">
                        <a href="{% url 'content:post_create' %}" class="quick-action-btn">
                            <i class="fas fa-plus-circle"></i>
                            <span>Nueva Publicaci칩n</span>
                        </a>
                        <a href="{% url 'content:post_draft_list' %}" class="quick-action-btn">
                            <i class="fas fa-edit"></i>
                            <span>Borradores</span>
                            {% if draft_count > 0 %}
                            <span class="action-badge">{{ draft_count }}</span>
                            {% endif %}
                        </a>
                        <a href="{% url 'content:home_feed' %}" class="quick-action-btn">
                            <i class="fas fa-newspaper"></i>
                            <span>Ver Feed</span>
                        </a>
                        {% if user.is_creator %}
                        <a href="#" class="quick-action-btn">
                            <i class="fas fa-chart-bar"></i>
                            <span>Anal칤ticas</span>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Estad칤sticas de Seguidores -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Seguidores</h2>
                </div>
                <div class="section-content">
                    <div class="follower-stats">
                        <div class="follower-metric">
                            <span class="follower-number">{{ user.followers_count }}</span>
                            <span class="follower-label">Seguidores Totales</span>
                        </div>
                        <div class="follower-metric">
                            <span class="follower-number">{{ user.following_count }}</span>
                            <span class="follower-label">Siguiendo</span>
                        </div>
                        {% if user.is_creator %}
                        <div class="follower-metric highlight">
                            <span class="follower-number">{{ user.creator_profile.total_subscribers }}</span>
                            <span class="follower-label">Suscriptores Premium</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Notificaciones del Sistema -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-info-circle"></i> Novedades</h2>
                </div>
                <div class="section-content">
                    <div class="system-notices">
                        <div class="notice-item">
                            <i class="fas fa-rocket text-primary"></i>
                            <div>
                                <strong>Nueva actualizaci칩n disponible</strong>
                                <p>Mejoras en el sistema de comentarios</p>
                            </div>
                        </div>
                        <div class="notice-item">
                            <i class="fas fa-gift text-primary"></i>
                            <div>
                                <strong>Evento especial</strong>
                                <p>Gana premios por crear contenido</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// JavaScript espec칤fico para el dashboard
document.addEventListener('DOMContentLoaded', function() {
    // Animaciones para las tarjetas de estad칤sticas
    const statCards = document.querySelectorAll('.stat-card');
    statCards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('fade-in');
    });

    // Actualizaci칩n en tiempo real de estad칤sticas
    function updateLiveStats() {
        // Aqu칤 ir칤a la l칩gica para actualizar estad칤sticas en tiempo real
        console.log('Actualizando estad칤sticas...');
    }

    // Actualizar cada 30 segundos
    setInterval(updateLiveStats, 30000);
});
</script>
{% endblock %}