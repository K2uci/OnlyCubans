{% extends "content/base/base.html" %}
{% load static %}

{% block title %}Dashboard - OnlyCubans{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/content/dashboard/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Welcome Section -->
    <div class="dashboard-welcome">
        <div class="welcome-content">
            <h1>Hola, {{ user.username }}! üëã</h1>
            <p class="welcome-subtitle">Bienvenido a tu panel de control. Aqu√≠ tienes un resumen de tu actividad y estad√≠sticas.</p>
            
            <!-- Quick Stats -->
            <div class="quick-stats-grid">
                {% if user.is_creator %}
                <div class="stat-card">
                    <div class="stat-value">{{ stats.total_posts|default:0 }}</div>
                    <div class="stat-label">Publicaciones</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>12% vs √∫ltimo mes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ stats.total_views|default:0 }}</div>
                    <div class="stat-label">Vistas Totales</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>8% vs √∫ltimo mes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ stats.total_likes|default:0 }}</div>
                    <div class="stat-label">Me Gusta</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>15% vs √∫ltimo mes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ user.creator_profile.total_subscribers|default:0 }}</div>
                    <div class="stat-label">Suscriptores</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>5 nuevos este mes</span>
                    </div>
                </div>
                {% else %}
                <div class="stat-card">
                    <div class="stat-value">{{ user.following_count }}</div>
                    <div class="stat-label">Siguiendo</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>3 nuevos este mes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ user.posts.count }}</div>
                    <div class="stat-label">Mis Posts</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>2 nuevos este mes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ user.bookmarks.count }}</div>
                    <div class="stat-label">Guardados</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>7 nuevos este mes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ user.followers_count }}</div>
                    <div class="stat-label">Seguidores</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>5 nuevos este mes</span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- Columna Principal -->
        <div class="dashboard-main">
            {% if user.is_creator %}
            <!-- Dashboard para Creadores -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-line"></i> M√©tricas de Rendimiento</h2>
                    <div class="section-actions">
                        <a href="{% url 'content:analytics' %}" class="view-all-link">Ver anal√≠ticas completas</a>
                    </div>
                </div>
                <div class="section-content">
                    <div class="performance-metrics">
                        <div class="metric-card">
                            <div class="metric-value">{{ stats.total_earnings|default:0|floatformat:2 }}$</div>
                            <div class="metric-label">Ganancias Totales</div>
                            <div class="metric-change change-positive">+12% este mes</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">{{ stats.engagement_rate|default:0|floatformat:1 }}%</div>
                            <div class="metric-label">Tasa de Engagement</div>
                            <div class="metric-change change-positive">+3.2% este mes</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">{{ stats.avg_views|default:0 }}</div>
                            <div class="metric-label">Vistas/Promedio</div>
                            <div class="metric-change change-positive">+15% este mes</div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Actividad Reciente -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-bell"></i> Actividad Reciente</h2>
                    <div class="section-actions">
                        <a href="#" class="view-all-link">Ver todo</a>
                    </div>
                </div>
                <div class="section-content">
                    <div class="activity-feed">
                        {% for like in recent_activity.new_likes|slice:":5" %}
                        <div class="activity-item">
                            <img src="{% if like.user.profile_picture %}{{ like.user.profile_picture.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}" 
                                 alt="{{ like.user.username }}" 
                                 class="activity-avatar">
                            <div class="activity-content">
                                <div class="activity-text">
                                    <strong>{{ like.user.username }}</strong> le dio me gusta a tu publicaci√≥n
                                </div>
                                <div class="activity-time">{{ like.created_at|timesince }} ago</div>
                            </div>
                            <span class="activity-badge">Like</span>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <i class="fas fa-bell-slash empty-state-icon"></i>
                            <div class="empty-state-title">No hay actividad reciente</div>
                            <p>Tu actividad aparecer√° aqu√≠ cuando interact√∫en con tu contenido.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Publicaciones Recientes -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-newspaper"></i> Tus Publicaciones Recientes</h2>
                    <div class="section-actions">
                        <a href="{% url 'content:post_create' %}" class="view-all-link">Crear nuevo</a>
                    </div>
                </div>
                <div class="section-content">
                    {% if recent_posts %}
                    <div class="content-cards-grid">
                        {% for post in recent_posts %}
                        <div class="content-card">
                            {% if post.media_files.first %}
                            <img src="{{ post.media_files.first.file.url }}" 
                                 alt="{{ post.title }}"
                                 class="content-card-image">
                            {% else %}
                            <div class="content-card-image" style="background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-image fa-2x" style="color: var(--text-tertiary);"></i>
                            </div>
                            {% endif %}
                            <div class="content-card-body">
                                <h4 class="content-card-title">{{ post.title|truncatewords:8 }}</h4>
                                <p class="content-card-description">{{ post.description|truncatewords:12 }}</p>
                                <div class="content-card-stats">
                                    <span><i class="fas fa-eye"></i> {{ post.views_count }}</span>
                                    <span><i class="fas fa-heart"></i> {{ post.likes_count }}</span>
                                    <span><i class="fas fa-comment"></i> {{ post.comments_count }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-edit empty-state-icon"></i>
                        <div class="empty-state-title">No hay publicaciones a√∫n</div>
                        <p>Comienza creando tu primera publicaci√≥n para compartir con la comunidad.</p>
                        <div class="empty-state-actions">
                            <a href="{% url 'content:post_create' %}" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Crear Primera Publicaci√≥n
                            </a>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar del Dashboard -->
        <div class="dashboard-sidebar">
            <!-- Acciones R√°pidas -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-bolt"></i> Acciones R√°pidas</h2>
                </div>
                <div class="section-content">
                    <div class="quick-actions">
                        <a href="{% url 'content:post_create' %}" class="quick-action-btn">
                            <div class="quick-action-icon">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="quick-action-content">
                                <div class="quick-action-title">Nueva Publicaci√≥n</div>
                                <div class="quick-action-desc">Comparte nuevo contenido</div>
                            </div>
                        </a>
                        <a href="{% url 'content:post_draft_list' %}" class="quick-action-btn">
                            <div class="quick-action-icon">
                                <i class="fas fa-edit"></i>
                            </div>
                            <div class="quick-action-content">
                                <div class="quick-action-title">Borradores</div>
                                <div class="quick-action-desc">Contin√∫a editando</div>
                            </div>
                            {% if draft_count > 0 %}
                            <span class="action-badge">{{ draft_count }}</span>
                            {% endif %}
                        </a>
                        <a href="{% url 'content:home_feed' %}" class="quick-action-btn">
                            <div class="quick-action-icon">
                                <i class="fas fa-newspaper"></i>
                            </div>
                            <div class="quick-action-content">
                                <div class="quick-action-title">Ver Feed</div>
                                <div class="quick-action-desc">Explora contenido</div>
                            </div>
                        </a>
                        {% if user.is_creator %}
                        <a href="{% url 'content:analytics' %}" class="quick-action-btn">
                            <div class="quick-action-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="quick-action-content">
                                <div class="quick-action-title">Anal√≠ticas</div>
                                <div class="quick-action-desc">M√©tricas detalladas</div>
                            </div>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Estad√≠sticas de Seguidores -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Seguidores</h2>
                </div>
                <div class="section-content">
                    <div class="follower-stats">
                        <div class="follower-metric">
                            <span class="follower-number">{{ user.followers_count }}</span>
                            <span class="follower-label">Seguidores Totales</span>
                        </div>
                        <div class="follower-metric">
                            <span class="follower-number">{{ user.following_count }}</span>
                            <span class="follower-label">Siguiendo</span>
                        </div>
                        {% if user.is_creator %}
                        <div class="follower-metric highlight">
                            <span class="follower-number">{{ user.creator_profile.total_subscribers }}</span>
                            <span class="follower-label">Suscriptores Premium</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Notificaciones del Sistema -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-info-circle"></i> Novedades</h2>
                </div>
                <div class="section-content">
                    <div class="system-notices">
                        <div class="notice-item">
                            <i class="fas fa-rocket text-primary"></i>
                            <div class="notice-content">
                                <div class="notice-title">Nueva actualizaci√≥n disponible</div>
                                <div class="notice-text">Mejoras en el sistema de comentarios</div>
                            </div>
                        </div>
                        <div class="notice-item">
                            <i class="fas fa-gift text-primary"></i>
                            <div class="notice-content">
                                <div class="notice-title">Evento especial</div>
                                <div class="notice-text">Gana premios por crear contenido</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// JavaScript espec√≠fico para el dashboard
document.addEventListener('DOMContentLoaded', function() {
    // Animaciones para las tarjetas de estad√≠sticas
    const statCards = document.querySelectorAll('.stat-card');
    statCards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('fade-in');
    });

    // Actualizaci√≥n en tiempo real de estad√≠sticas
    function updateLiveStats() {
        // Aqu√≠ ir√≠a la l√≥gica para actualizar estad√≠sticas en tiempo real
        console.log('Actualizando estad√≠sticas...');
    }

    // Actualizar cada 30 segundos
    setInterval(updateLiveStats, 30000);
});
</script>
{% endblock %}