{% extends "content/base/base.html" %}
{% load static %}

{% block title %}Descubrir - OnlyCubans{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/content/feeds/feeds.css' %}">
<link rel="stylesheet" href="{% static 'css/content/feeds/feed_discover.css' %}">
{% endblock %}

{% block content %}
<div class="feeds-container">
    <!-- Feed Header -->
    <div class="feed-header">
        <nav class="feed-nav">
            <a href="{% url 'content:home_feed' %}" class="feed-nav-item">
                <i class="fas fa-home"></i>
                <span>Mi Feed</span>
            </a>
            <a href="{% url 'content:discover_feed' %}" class="feed-nav-item active">
                <i class="fas fa-compass"></i>
                <span>Descubrir</span>
            </a>
            <a href="{% url 'content:post_list' %}" class="feed-nav-item">
                <i class="fas fa-fire"></i>
                <span>Trending</span>
            </a>
        </nav>

        <div class="feed-filters">
            <div class="filter-group">
                <span class="filter-label">Categoría:</span>
                <select class="filter-select" onchange="updateCategory(this.value)">
                    <option value="all">Todas las categorías</option>
                    <option value="music">Música</option>
                    <option value="art">Arte</option>
                    <option value="food">Comida</option>
                    <option value="sports">Deportes</option>
                </select>
            </div>
            
            <div class="filter-group">
                <span class="filter-label">Ordenar por:</span>
                <select class="filter-select" onchange="updateDiscoverSort(this.value)">
                    <option value="popular">Más popular</option>
                    <option value="recent">Más reciente</option>
                    <option value="trending">Trending</option>
                </select>
            </div>
        </div>
    </div>

    <div class="feed-grid">
        <!-- Contenido Principal -->
        <div class="feed-main">
            <div class="discover-feed">
                <!-- Header de Descubrir -->
                <div class="discover-header">
                    <h1 class="discover-title">Explora Contenido Increíble</h1>
                    <p class="discover-subtitle">Descubre nuevos creadores y contenido trending de la comunidad cubana</p>
                </div>

                <!-- Categorías -->
                <div class="discover-categories">
                    <div class="categories-grid">
                        <a href="{% url 'content:category_feed' 'musica' %}" class="category-item">
                            <div class="category-icon">
                                <i class="fas fa-music"></i>
                            </div>
                            <div class="category-name">Música</div>
                            <div class="category-count">1.2K publicaciones</div>
                        </a>
                        <a href="{% url 'content:category_feed' 'arte' %}" class="category-item">
                            <div class="category-icon">
                                <i class="fas fa-paint-brush"></i>
                            </div>
                            <div class="category-name">Arte</div>
                            <div class="category-count">856 publicaciones</div>
                        </a>
                        <a href="{% url 'content:category_feed' 'comida' %}" class="category-item">
                            <div class="category-icon">
                                <i class="fas fa-utensils"></i>
                            </div>
                            <div class="category-name">Comida</div>
                            <div class="category-count">723 publicaciones</div>
                        </a>
                        <a href="{% url 'content:category_feed' 'deportes' %}" class="category-item">
                            <div class="category-icon">
                                <i class="fas fa-dumbbell"></i>
                            </div>
                            <div class="category-name">Deportes</div>
                            <div class="category-count">512 publicaciones</div>
                        </a>
                        <a href="{% url 'content:category_feed' 'danza' %}" class="category-item">
                            <div class="category-icon">
                                <i class="fas fa-music"></i>
                            </div>
                            <div class="category-name">Danza</div>
                            <div class="category-count">398 publicaciones</div>
                        </a>
                        <a href="{% url 'content:category_feed' 'literatura' %}" class="category-item">
                            <div class="category-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="category-name">Literatura</div>
                            <div class="category-count">287 publicaciones</div>
                        </a>
                    </div>
                </div>

                <!-- Trending -->
                <div class="discover-trending">
                    <h2 class="section-title">
                        <i class="fas fa-fire"></i>
                        Trending Esta Semana
                    </h2>
                    <div class="trending-grid">
                        {% for trending_post in trending_posts|slice:":6" %}
                        <div class="trending-card">
                            <div class="trending-card-header">
                                {% if trending_post.media_files.first %}
                                <img src="{{ trending_post.media_files.first.file.url }}" 
                                     alt="{{ trending_post.title }}"
                                     class="trending-card-image">
                                {% else %}
                                <div style="background: var(--bg-tertiary); height: 100%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-image fa-3x" style="color: var(--text-tertiary);"></i>
                                </div>
                                {% endif %}
                                <div class="trending-badge">#{{ forloop.counter }}</div>
                            </div>
                            <div class="trending-card-body">
                                <h3 class="trending-card-title">{{ trending_post.title|truncatewords:6 }}</h3>
                                <p class="trending-card-description">{{ trending_post.description|truncatewords:15 }}</p>
                                <div class="trending-card-stats">
                                    <span><i class="fas fa-eye"></i> {{ trending_post.views_count }}</span>
                                    <span><i class="fas fa-heart"></i> {{ trending_post.likes_count }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Creadores Recomendados -->
                <div class="recommended-creators">
                    <h2 class="section-title">
                        <i class="fas fa-star"></i>
                        Creadores Destacados
                    </h2>
                    <div class="creators-grid">
                        {% for creator in recommended_creators|slice:":4" %}
                        <div class="creator-card">
                            <img src="{% if creator.profile_picture %}{{ creator.profile_picture.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}" 
                                 alt="{{ creator.username }}" 
                                 class="creator-avatar">
                            <h3 class="creator-name">{{ creator.username }}</h3>
                            <div class="creator-category">{{ creator.creator_profile.category|default:"Creador de Contenido" }}</div>
                            <div class="creator-stats">
                                <div class="creator-stat">
                                    <div class="creator-stat-value">{{ creator.followers_count }}</div>
                                    <div class="creator-stat-label">Seguidores</div>
                                </div>
                                <div class="creator-stat">
                                    <div class="creator-stat-value">{{ creator.posts.count }}</div>
                                    <div class="creator-stat-label">Posts</div>
                                </div>
                            </div>
                            <button class="follow-btn" data-creator-id="{{ creator.id }}">
                                {% if creator in user.following_relationships.all %}
                                    Siguiendo
                                {% else %}
                                    Seguir
                                {% endif %}
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Contenido del Feed -->
                <div class="feed-content">
                    <div class="feed-sort">
                        <h3 class="feed-sort-title">Contenido Recomendado</h3>
                        <div class="feed-sort-options">
                            <button class="sort-option active" data-sort="recommended">Recomendado</button>
                            <button class="sort-option" data-sort="recent">Reciente</button>
                            <button class="sort-option" data-sort="popular">Popular</button>
                        </div>
                    </div>

                    <div class="feed-posts">
                        {% if page_obj %}
                            {% for post in page_obj %}
                                {% include "content/base/post_card.html" with post=post %}
                            {% endfor %}

                            <!-- Paginación -->
                            {% include "content/base/pagination.html" with page_obj=page_obj %}
                        {% else %}
                            <div class="feed-empty-state">
                                <i class="fas fa-compass feed-empty-icon"></i>
                                <h3 class="feed-empty-title">Explorando nuevo contenido</h3>
                                <p class="feed-empty-description">
                                    Prueba ajustando los filtros o explorando diferentes categorías para descubrir contenido increíble.
                                </p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="feed-sidebar">
            <!-- Eventos en Vivo -->
            <div class="sidebar-widget">
                <div class="widget-header">
                    <h3><i class="fas fa-broadcast-tower"></i> En Vivo Ahora</h3>
                </div>
                <div class="widget-content">
                    <div class="live-events">
                        <div class="live-event">
                            <div class="live-indicator"></div>
                            <div class="event-info">
                                <div class="event-title">Concierto de Salsa</div>
                                <div class="event-creator">@Carlos_Music</div>
                                <div class="event-viewers">245 viendo</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Categorías Populares -->
            <div class="sidebar-widget">
                <div class="widget-header">
                    <h3><i class="fas fa-tags"></i> Categorías Populares</h3>
                </div>
                <div class="widget-content">
                    <div class="popular-categories">
                        {% for category in popular_categories|slice:":6" %}
                        <a href="{% url 'content:category_feed' category.slug %}" class="category-link">
                            <i class="fas fa-{{ category.icon }}"></i>
                            <span>{{ category.name }}</span>
                            <span class="category-count">{{ category.content_count }}</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Newsletter -->
            <div class="sidebar-widget">
                <div class="widget-header">
                    <h3><i class="fas fa-envelope"></i> Mantente Informado</h3>
                </div>
                <div class="widget-content">
                    <div class="newsletter">
                        <p>Recibe las mejores recomendaciones en tu email</p>
                        <form class="newsletter-form">
                            <input type="email" placeholder="Tu email" class="form-control">
                            <button type="submit" class="btn btn-primary">Suscribirse</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}